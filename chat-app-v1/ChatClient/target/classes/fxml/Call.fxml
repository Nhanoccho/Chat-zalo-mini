<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.image.ImageView?>

<StackPane xmlns="http://javafx.com/javafx/19"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.chatapp.client.controller.CallController"
           prefHeight="600" prefWidth="800"
           style="-fx-background-color: #1a1a1a;">

    <!-- Video Container (for video calls) -->
    <VBox fx:id="videoContainer" visible="false" managed="false" alignment="CENTER">
        <!-- Remote Video (full screen) -->
        <StackPane VBox.vgrow="ALWAYS">
            <ImageView fx:id="remoteVideoView"
                      fitWidth="800" fitHeight="600"
                      preserveRatio="true"
                      style="-fx-effect: dropshadow(gaussian, rgba(0,0,0,0.8), 10, 0, 0, 0);"/>

            <!-- Local Video Preview (small, top-right corner) -->
            <StackPane alignment="TOP_RIGHT">
                <StackPane.margin>
                    <Insets top="20" right="20"/>
                </StackPane.margin>
                <ImageView fx:id="localVideoView"
                          fitWidth="200" fitHeight="150"
                          preserveRatio="true"
                          style="-fx-effect: dropshadow(gaussian, rgba(0,0,0,0.8), 10, 0, 0, 0); -fx-border-color: white; -fx-border-width: 2;"/>
            </StackPane>
        </StackPane>
    </VBox>

    <!-- Voice Call UI (for voice calls) -->
    <VBox fx:id="voiceContainer" alignment="CENTER" spacing="20" prefHeight="600" prefWidth="800"
          style="-fx-background-color: linear-gradient(to bottom, #667eea 0%, #764ba2 100%);">

        <padding>
            <Insets top="30" right="30" bottom="30" left="30"/>
        </padding>

        <!-- Call Type -->
        <Label fx:id="callTypeLabel" text="Voice Call"
               style="-fx-text-fill: white; -fx-font-size: 18; -fx-font-weight: bold;">
            <VBox.margin>
                <Insets top="10"/>
            </VBox.margin>
        </Label>

        <!-- Caller Avatar/Icon -->
        <VBox alignment="CENTER" spacing="10">
            <Label text="ðŸ‘¤" style="-fx-font-size: 80;"/>
        </VBox>

        <!-- Caller Name -->
        <Label fx:id="callerNameLabel" text="Caller Name"
               style="-fx-text-fill: white; -fx-font-size: 24; -fx-font-weight: bold;"/>

        <!-- Call Status -->
        <Label fx:id="callStatusLabel" text="Calling..."
               style="-fx-text-fill: #e0e0e0; -fx-font-size: 14;"/>

        <!-- Call Duration -->
        <Label fx:id="callDurationLabel" text="00:00"
               style="-fx-text-fill: white; -fx-font-size: 32; -fx-font-weight: bold;">
            <VBox.margin>
                <Insets top="20"/>
            </VBox.margin>
        </Label>

        <!-- Spacer -->
        <Region VBox.vgrow="ALWAYS"/>
    </VBox>

    <!-- Call Control Buttons (overlay) -->
    <VBox alignment="BOTTOM_CENTER">
        <VBox.margin>
            <Insets bottom="30"/>
        </VBox.margin>

        <HBox alignment="CENTER" spacing="30">
            <!-- Mute Button (for active calls) -->
            <VBox fx:id="muteButtonContainer" alignment="CENTER" spacing="5" visible="false" managed="false">
                <Button fx:id="muteButton" text="ðŸŽ¤" onAction="#handleToggleMute"
                       prefWidth="60" prefHeight="60"
                       style="-fx-background-color: rgba(255,255,255,0.3); -fx-text-fill: white; -fx-font-size: 24; -fx-background-radius: 50; -fx-cursor: hand;"/>
                <Label fx:id="muteLabel" text="Mute" style="-fx-text-fill: white; -fx-font-size: 11;"/>
            </VBox>

            <!-- Camera Toggle Button (for video calls) -->
            <VBox fx:id="cameraButtonContainer" alignment="CENTER" spacing="5" visible="false" managed="false">
                <Button fx:id="cameraButton" text="ðŸ“¹" onAction="#handleToggleCamera"
                       prefWidth="60" prefHeight="60"
                       style="-fx-background-color: rgba(255,255,255,0.3); -fx-text-fill: white; -fx-font-size: 24; -fx-background-radius: 50; -fx-cursor: hand;"/>
                <Label fx:id="cameraLabel" text="Camera" style="-fx-text-fill: white; -fx-font-size: 11;"/>
            </VBox>

            <!-- Accept Button (for incoming calls) -->
            <VBox fx:id="acceptButtonContainer" alignment="CENTER" spacing="5">
                <Button fx:id="acceptButton" text="âœ“" onAction="#handleAcceptCall"
                       prefWidth="70" prefHeight="70"
                       style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-font-size: 32; -fx-background-radius: 50; -fx-cursor: hand;"/>
                <Label text="Accept" style="-fx-text-fill: white; -fx-font-size: 12;"/>
            </VBox>

            <!-- End Call Button -->
            <VBox alignment="CENTER" spacing="5">
                <Button fx:id="endCallButton" text="âœ•" onAction="#handleEndCall"
                       prefWidth="70" prefHeight="70"
                       style="-fx-background-color: #f44336; -fx-text-fill: white; -fx-font-size: 32; -fx-background-radius: 50; -fx-cursor: hand;"/>
                <Label text="End Call" style="-fx-text-fill: white; -fx-font-size: 12;"/>
            </VBox>

            <!-- Reject Button (for incoming calls) -->
            <VBox fx:id="rejectButtonContainer" alignment="CENTER" spacing="5">
                <Button fx:id="rejectButton" text="âœ•" onAction="#handleRejectCall"
                       prefWidth="70" prefHeight="70"
                       style="-fx-background-color: #f44336; -fx-text-fill: white; -fx-font-size: 32; -fx-background-radius: 50; -fx-cursor: hand;"/>
                <Label text="Reject" style="-fx-text-fill: white; -fx-font-size: 12;"/>
            </VBox>
        </HBox>
    </VBox>

    <!-- Call info overlay (for video calls) -->
    <VBox fx:id="videoInfoOverlay" alignment="TOP_LEFT" visible="false" managed="false">
        <VBox.margin>
            <Insets top="20" left="20"/>
        </VBox.margin>

        <Label fx:id="videoCallerNameLabel" text="Caller Name"
               style="-fx-text-fill: white; -fx-font-size: 20; -fx-font-weight: bold; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.8), 5, 0, 0, 0);"/>

        <Label fx:id="videoCallStatusLabel" text="Connected"
               style="-fx-text-fill: #4caf50; -fx-font-size: 14; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.8), 5, 0, 0, 0);">
            <VBox.margin>
                <Insets top="5"/>
            </VBox.margin>
        </Label>

        <Label fx:id="videoCallDurationLabel" text="00:00"
               style="-fx-text-fill: white; -fx-font-size: 16; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.8), 5, 0, 0, 0);">
            <VBox.margin>
                <Insets top="5"/>
            </VBox.margin>
        </Label>
    </VBox>
</StackPane>
